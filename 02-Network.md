<link href="style.css" rel="stylesheet"></link>

**[ [Home](00-Home.html) | [Systemd](01-Systemd.html) | Network | [FFmpeg](03-FFmpeg.html) | [Bugs](04-Bugs.html) | [Other](99-Other.html) ]**

## Network

---

#### Reference

* Configuration
    
    https://wiki.debian.org/NetworkConfiguration  
    [https://www.fr.linuxfromscratch.org/.../network.html](https://www.fr.linuxfromscratch.org/view/lfs-7.9-systemd-fr/chapter07/network.html)  

* Read network configuration
    
    `networkctl`
    
    `ip route show default`
    
    `ip route show default | cut -d " " -f 5`

* Read DNS servers
    
    `cat /etc/resolv.conf`

* Predictable Network Interface Names
    
    [https://www.freedesktop.org/.../PredictableNetworkInterfaceNames](https://www.freedesktop.org/wiki/Software/systemd/PredictableNetworkInterfaceNames/)  
    
    Switch back to eth0 :
    
    Add `GRUB_CMDLINE_LINUX="net.ifnames=0"` in `/etc/default/grub`
    
    Execute `sudo update-grub`
    
* Set BBox name in hosts file

    `echo "192.168.1.254  mabbox.bytel.fr" >> /etc/hosts`

* Disable IPv6 in Kernel

    Edit `/etc/default/grub` and add `ipv6.disable=1` :
    
    `GRUB_CMDLINE_LINUX_DEFAULT="ipv6.disable=1 quiet"`

    Update grub :

    `sudo update-grub`


#### Switch back to /etc/network/interfaces

* References
    
    https://askubuntu.com/questions/1031709/  
    [https://linuxconfig.org/how-to-switch-back-networking-to-etc](https://linuxconfig.org/how-to-switch-back-networking-to-etc-network-interfaces-on-ubuntu-20-04-focal-fossa-linux)  
    [https://support.solusvm.com/hc/en-us/articles/360018794671-H](https://support.solusvm.com/hc/en-us/articles/360018794671-How-to-configure-Ubuntu-18-to-use-eth0-and-switch-back-to-etc-network-interfaces-file-)  
    https://fr.linux-console.net/?p=1413#gsc.tab=0  
    https://askubuntu.com/questions/249944/  
    https://help.ubuntu.com/community/NetworkManager  
    [https://techpiezo.com/linux/switch-back-to-ifupdown](https://techpiezo.com/linux/switch-back-to-ifupdown-etc-network-interfaces-in-ubuntu/)  

* resolvconf
    
    
    ```
    # check to see if resolvconf is installed
    sudo systemctl status resolvconf.service

    # install resolveconf package
    sudo apt update
    sudo apt install ifupdown resolvconf

    # confirm resolveconf is running
    sudo systemctl status resolvconf.service

    # if resolveconf isn't running, enable then start it
    sudo systemctl enable resolvconf.service
    sudo systemctl start resolvconf.service

    # check resolveconf status
    sudo systemctl status resolvconf.service

    # edit the head file
    sudo nano /etc/resolvconf/resolv.conf.d/head

    # enter your nameservers below the comments
    nameserver 8.8.8.8
    nameserver 8.8.4.4

    # update resolve.conf file
    sudo resolvconf --enable-updates
    sudo resolvconf -u

    # check if changes we successful
    sudo nano /etc/resolv.conf
    ```

* Disable network manager

    ```
    sudo systemctl stop NetworkManager.service
    sudo systemctl disable NetworkManager.service
    sudo systemctl stop NetworkManager-wait-online.service
    sudo systemctl disable NetworkManager-wait-online.service
    sudo systemctl stop NetworkManager-dispatcher.service
    sudo systemctl disable NetworkManager-dispatcher.service
    sudo systemctl stop network-manager.service
    sudo systemctl disable network-manager.service
    ```

* Interface
    
    Create `/etc/network/interfaces`

    ```
    # The loopback network interface
    auto lo
    iface lo inet loopback

    allow-hotplug eth0
    auto eth0
    iface eth0 inet static
      address 192.168.1.100
      netmask 255.255.255.0
      broadcast 192.168.1.255
      gateway 192.168.1.254
      # Only relevant if you make use of RESOLVCONF(8)
      # or similar...
      #dns-nameservers 8.8.8.8 8.8.4.4
    ```

    ```
    cat /etc/resolv.conf 
    # Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
    #     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
    # 127.0.0.53 is the systemd-resolved stub resolver.
    # run "systemd-resolve --status" to see details about the actual nameservers.
    nameserver 8.8.8.8
    nameserver 8.8.4.4
    nameserver 127.0.0.53
    ```

* Uninstall network manager

    Remove NetworkManager from the system

    ```
    sudo apt purge network-manager
    ```

    Configure eth0 using ifup.

    ```
    sudo ifup eth0
    ```

* Enable eth0

    `ln -s /dev/null /etc/systemd/network/99-default.link`
    

#### Use systemd-networkd

* Use systemd-networkd
    
    [https://linux.fernandocejas.com/docs/...systemd-networkd](https://linux.fernandocejas.com/docs/how-to/switch-from-network-manager-to-systemd-networkd)  
    
    Create a configuration file :
    
    `/etc/systemd/network/00-eth0.network`

    ```
    [Match]
    Name=eth0

    [Network]
    LinkLocalAddressing=no
    IPv6AcceptRA=no
    DHCP=no
    Address=192.168.1.101/24
    Gateway=192.168.1.254
    DNS=8.8.8.8
    DNS=8.8.4.4
    ```
    
    Start services :
    
    ```
    sudo apt install systemd-resolved

    sudo systemctl stop NetworkManager
    sudo systemctl disable NetworkManager

    sudo systemctl enable systemd-networkd

    sudo systemctl enable systemd-resolved
    sudo systemctl start systemd-resolved

    sudo mv /etc/resolv.conf /etc/resolv.conf.bak
    sudo ln -s /run/systemd/resolve/resolv.conf /etc/resolv.conf

    networkctl
    ```

<!--

* Disable IPv6

    In `/etc/sysctl.conf` add the following :
    
    ```
    net.ipv6.conf.all.disable_ipv6 = 1
    net.ipv6.conf.default.disable_ipv6 = 1
    net.ipv6.conf.lo.disable_ipv6 = 1
    net.ipv6.conf.tun0.disable_ipv6 = 1
    ```
    
    Reboot the system.

-->


